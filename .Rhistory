"seg5_name",
"seg5_count",
"seg6_name",
"seg6_count",
"seg7_name",
"seg7_count",
"seg8_name",
"seg8_count",
"seg9_name",
"seg9_count",
"seg10_name",
"seg10_count",
"chosen_segment",
"segment_starting_point"
)
make_segments_df <- function(list_st_pt){
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
segments_df <- data.frame(
cluster_code = list_st_pt$cluster_code,
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
return(segments_df)
}
segments_df <- make_segments_df(list_st_pt)
View(segments_df)
View(segments_df)
summary %>% left_join(segments_df)
make_segments_df <- function(list_st_pt){
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
segments_df <- data.frame(
cluster_code = as.numeric(list_st_pt$cluster_code),
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
return(segments_df)
}
segments_df <- make_segments_df(list_st_pt)
summary %>% left_join(segments_df)
Summary_ <- summary %>% left_join(segments_df)
Summary_seg <- summary %>% left_join(segments_df)
View(Summary_seg)
write.csv(summary_seg, "who-dash/Data/summary.csv", row.names = F, na = "")
write.csv(listing_filled,
"who-dash/Data/listing.csv",
row.names = F,
na = "")
View(list_st_pt)
View(list_st_pt)
runApp('who-dash')
write.csv(list_st_pt,
"who-dash/Data/segments.csv",
row.names = F,
na = "")
runApp('who-dash')
runApp('who-dash')
list_st_pt$chosen_segment_name <- segments_df$seg_name
View(list_st_pt)
View(list_st_pt)
seg_formatter <- formatter("span",
style = ~ style(color = ifelse(change >= 0, "green", "red")))
View(list_st_pt)
View(list_st_pt)
list_st_pt$chosen_segment_name <- segments_df$seg_name
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/who-dash/preproc0.R")
source("~/Desktop/R-Projects/WHO/preproc1.R")
source("~/Desktop/R-Projects/WHO/preproc2.R")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/who-dash/summarise.r")
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary$disc_hh <- round(summary$n_hh / summary$est_hh_who, 2)
summary_seg <- summary %>% left_join(segments_df)
segments_df$cluster_code
summary$cluster_code
summary$cluster_code <- as.numeric(summary$cluster_code)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/who-dash/preproc0.R")
source("~/Desktop/R-Projects/WHO/preproc1.R")
source("~/Desktop/R-Projects/WHO/preproc2.R")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/who-dash/summarise.r")
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == seg_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == segment_name, 1, 0)
segments_df <- make_segments_df(list_st_pt)
list_st_pt$chosen_segment_name <- segments_df$seg_name
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == segment_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log3 <- ifelse(list_st_pt$seg3_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log4 <- ifelse(list_st_pt$seg4_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log5 <- ifelse(list_st_pt$seg5_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log6 <- ifelse(list_st_pt$seg6_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log7 <- ifelse(list_st_pt$seg7_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log8 <- ifelse(list_st_pt$seg8_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log9 <- ifelse(list_st_pt$seg9_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log10 <- ifelse(list_st_pt$seg10_name == list_st_pt$chosen_segment_name, 1, 0)
View(list_st_pt)
View(list_st_pt)
runApp('who-dash')
runApp('who-dash')
write.csv(list_st_pt,
"who-dash/Data/segments.csv",
row.names = F,
na = "")
runApp('who-dash')
runApp('who-dash')
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.R")
source("~/Desktop/R-Projects/WHO/preproc1.R")
source("~/Desktop/R-Projects/WHO/preproc2.R")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
shiny::runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
shiny::runApp('who-dash')
View(summary)
View(summary)
summary$est_hh_eff <- ifelse(!is.na(summary$seg_id), summary$seg_count, summary$est_hh_who)
View(summary)
View(summary)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary$est_hh_eff <- ifelse(!is.na(summary$seg_id), summary$seg_count, summary$est_hh_who)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary_seg <- summary %>% left_join(segments_df)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary_seg <- summary %>% left_join(segments_df)
View(segments_df)
View(segments_df)
View(segments_df)
View(segments_df)
summary$cluster_code <- as.numeric(summary$cluster_code)
summary_seg <- summary %>% left_join(segments_df)
summary_seg <- summary_seg %>%
select(
c(
"cluster_code",
"province_name",
"district",
"n",
"n_str",
"max_str",
"n_hh",
"max_hh",
"est_hh_who",
"disc_hh",
"n_dwelling",
"n_non_dwelling",
"n_subs",
"seg_id",
"seg_name",
"seg_count"
)
)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary$cluster_code <- as.numeric(summary$cluster_code)
summary_seg <- summary %>% left_join(segments_df)
summary_seg$est_hh_eff <- ifelse(!is.na(summary_seg$seg_id), summary_seg$seg_count, summary$est_hh_who)
summary_seg$disc_hh <- round(summary_seg$n_hh / summary_seg$est_hh_eff, 2)
summary_seg <- summary_seg %>%
select(
c(
"cluster_code",
"province_name",
"district",
"n",
"n_str",
"max_str",
"n_hh",
"max_hh",
"est_hh_who",
"disc_hh",
"n_dwelling",
"n_non_dwelling",
"n_subs",
"seg_id",
"seg_name",
"seg_count"
)
)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
runApp('who-dash')
runApp('who-dash')
View(listing_summary_trim)
View(listing_summary_trim)
listing_summary_trim$start_time
preprocess_listing <- function(listing) {
listing_trim <- listing %>% select(
c(
"id",
"mohalla",
"str_stat",
"str_index",
"address_of_structure",
"unit",
"hh_stat",
"hh_stat_log",
"hh_index",
"head_of_house_hold",
"datetime_entry",
"submissions_id",
"non_dwelling_type",
"non_dwelling_other",
"remarks"
)
)
names(listing_trim) <-
c(
"entry_index",
"mohalla",
"str_stat",
"str_index",
"address_of_structure",
"unit",
"hh_type",
"hh_stat",
"hh_index",
"head_of_house_hold",
"datetime",
"id",
"non_dwelling_type",
"non_dwelling_other",
"remarks"
)
return(listing_trim)
}
listing_trim <- preprocess_listing(listing)
listing_join <- listing_summary_trim %>% left_join(listing_trim)
listing_join$est_hh_who <- as.numeric(listing_join$est_hh_who)
preprocess_listing <- function(listing) {
listing_trim <- listing %>% select(
c(
"id",
"mohalla",
"str_stat",
"str_index",
"address_of_structure",
"unit",
"hh_stat",
"hh_stat_log",
"hh_index",
"head_of_house_hold",
"datetime_entry",
"submissions_id",
"non_dwelling_type",
"non_dwelling_other",
"remarks"
)
)
names(listing_trim) <-
c(
"entry_index",
"mohalla",
"str_stat",
"str_index",
"address_of_structure",
"unit",
"hh_type",
"hh_stat",
"hh_index",
"head_of_house_hold",
"datetime",
"id",
"non_dwelling_type",
"non_dwelling_other",
"remarks"
)
return(listing_trim)
}
listing_trim <- preprocess_listing(listing)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
View(listing_filled)
View(listing_filled)
View(listing_filled)
View(listing_filled)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who, start_time, end_time) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
View(listing_filled)
View(listing_filled)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
start_date = first(start_time)
n = n(),
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
start_date = first(start_time),
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
View(summary)
View(summary)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
runApp('who-dash')
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
runApp('who-dash')
View(summary)
View(summary)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
start_date = first(start_time),
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
View(summary)
View(summary)
summary$cluster_code <- as.numeric(summary$cluster_code)
summary_seg <- summary %>% left_join(segments_df)
summary_seg$est_hh_eff <- ifelse(!is.na(summary_seg$seg_id), summary_seg$seg_count, summary$est_hh_who)
summary_seg$disc_hh <- round(summary_seg$n_hh / summary_seg$est_hh_eff, 2)
View(summary_seg)
View(summary_seg)
summary_seg <- summary_seg %>%
select(
c(
"cluster_code",
"province_name",
"district",
"start_date",
"n",
"n_str",
"max_str",
"n_hh",
"max_hh",
"est_hh_who",
"disc_hh",
"n_dwelling",
"n_non_dwelling",
"n_subs",
"seg_id",
"seg_name",
"seg_count"
)
)
View(summary_seg)
View(summary_seg)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/preproc0.r")
source("~/Desktop/R-Projects/WHO/preproc1.r")
source("~/Desktop/R-Projects/WHO/preproc2.r")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/summarise.r")
runApp('who-dash')
?read_csv
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
## read in the required data
summary <- read_csv('who-dash/Data/summary.csv', col_types = "iccciiiiiiniii")
View(summary)
View(summary)
str(summary)
runApp('who-dash')
