"disc_hh",
"n_dwelling",
"n_non_dwelling",
"n_subs"
)
)
write.csv(summary, "who-dash/Data/summary.csv", row.names = F)
write.csv(listing_filled,
"who-dash/Data/listing.csv",
row.names = F,
na = "")
runApp('who-dash')
View(summary)
View(summary)
summary$n_hh
summary$est_hh_who
summary$n_hh/ summary$est_hh_who
round(summary$n_hh/ summary$est_hh_who, 2)
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary$disc_hh <- round(summary$n_hh / summary$est_hh_who, 2)
summary <- summary %>%
select(
c(
"cluster_code",
"province_name",
"district",
"n",
"n_str",
"max_str",
"n_hh",
"max_hh",
"est_hh_who",
"disc_hh",
"n_dwelling",
"n_non_dwelling",
"n_subs"
)
)
View(summary)
View(summary)
write.csv(summary, "who-dash/Data/summary.csv", row.names = F)
write.csv(listing_filled,
"who-dash/Data/listing.csv",
row.names = F,
na = "")
runApp('who-dash')
?read_csv()
View(summary)
View(summary)
runApp('who-dash')
runApp('who-dash')
View(listing)
View(listing)
source("~/Desktop/R-Projects/WHO/read.r")
View(listing)
View(listing)
View(listing_summary)
View(listing_summary)
listing_summary
View(listing_summary)
names(listing_summary)
View(listing_summary)
View(listing_summary)
View(listing_summary)
View(listing_summary)
list_st_pt <- listing_summary %>%
select(
c(
"id",
"enumerator_name"
"enumerator_mobile"
list_st_pt <- listing_summary %>%
select(
c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"survey_time",
"prepopulate_cluster_code",
"detail_province_name",
"detail_division",
"detail_district_name",
"detail_estimated_no_of_households",
"need_segmention",
"segment_select_segment_divide",
"segment_select_segment_1_name",
"segment_select_segment1_count",
"segment_select_segment_2_name",
"segment_select_segment2_count",
"segment_select_segment_3_name",
"segment_select_segment3_count",
"segment_select_segment_4_name",
"segment_select_segment4_count",
"segment_select_segment_5_name",
"segment_select_segment5_count",
"segment_select_segment_6_name",
"segment_select_segment6_count",
"segment_select_segment_7_name",
"segment_select_segment7_count",
"segment_select_segment_8_name",
"segment_select_segment8_count",
"segment_select_segment_9_name",
"segment_select_segment9_count",
"segment_select_segment_10_name",
"segment_select_segment10_count",
"segment_select_confirmation_segment_work",
"segment_select_confirmation_segment_work_confirm",
"segment_select_confirmation_starting_point"
)
) %>%
filter(need_segmention == 1)
View(list_st_pt)
list_st_pt$prepopulate_cluster_code
unique(list_st_pt$prepopulate_cluster_code)
table(listing_summary$prepopulate_cluster_code)
list_st_pt <- listing_summary %>%
select(
c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"survey_time",
"prepopulate_cluster_code",
"detail_province_name",
"detail_division",
"detail_district_name",
"detail_estimated_no_of_households",
"need_segmention",
"segment_select_segment_divide",
"segment_select_segment_1_name",
"segment_select_segment1_count",
"segment_select_segment_2_name",
"segment_select_segment2_count",
"segment_select_segment_3_name",
"segment_select_segment3_count",
"segment_select_segment_4_name",
"segment_select_segment4_count",
"segment_select_segment_5_name",
"segment_select_segment5_count",
"segment_select_segment_6_name",
"segment_select_segment6_count",
"segment_select_segment_7_name",
"segment_select_segment7_count",
"segment_select_segment_8_name",
"segment_select_segment8_count",
"segment_select_segment_9_name",
"segment_select_segment9_count",
"segment_select_segment_10_name",
"segment_select_segment10_count",
"segment_select_confirmation_segment_work",
"segment_select_confirmation_segment_work_confirm",
"segment_select_confirmation_starting_point"
)
) %>%
filter(need_segmention == 1) %>%
filter(!duplicated(prepopulate_cluster_code))
View(listing_summary)
list_st_pt <- listing_summary %>%
select(
c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"prepopulate_cluster_code",
"detail_province_name",
"detail_division",
"detail_district_name",
"detail_estimated_no_of_households",
"need_segmention",
"segment_select_segment_divide",
"segment_select_segment_1_name",
"segment_select_segment1_count",
"segment_select_segment_2_name",
"segment_select_segment2_count",
"segment_select_segment_3_name",
"segment_select_segment3_count",
"segment_select_segment_4_name",
"segment_select_segment4_count",
"segment_select_segment_5_name",
"segment_select_segment5_count",
"segment_select_segment_6_name",
"segment_select_segment6_count",
"segment_select_segment_7_name",
"segment_select_segment7_count",
"segment_select_segment_8_name",
"segment_select_segment8_count",
"segment_select_segment_9_name",
"segment_select_segment9_count",
"segment_select_segment_10_name",
"segment_select_segment10_count",
"segment_select_confirmation_segment_work",
"segment_select_confirmation_starting_point"
)
) %>%
filter(need_segmention == 1) %>%
filter(!duplicated(prepopulate_cluster_code))
names(list_st_pt) <- c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"cluster_code",
"province",
"division",
"district",
"est_hh_who",
"need_segmention",
"n_segments",
"seg1_name",
"seg1_count",
"seg2_name",
"seg2_count",
"seg3_name",
"seg3_count",
"seg4_name",
"seg4_count",
"seg5_name",
"seg5_count",
"seg6_name",
"seg6_count",
"seg7_name",
"seg7_count",
"seg8_name",
"seg8_count",
"seg9_name",
"seg9_count",
"seg10_name",
"seg10_count",
"chosen_segment",
"segment_starting_point"
)
for (seg_id in list_st_pt$chosen_segment){
print(seg_id)
}
for (idx in nrow(list_st_pt)){
seg_id <- list_st_pt[idx]
print(seg_id)
}
seg_name <- c()
seg_count <- c()
for (idx in nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
print(seg_id)
}
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
print(seg_id)
}
seg_name_vec <- c()
seg_count_vec <- c()
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
segments_df <- data.frame(
seg_id <- list_st_pt$chosen_segment
seg_name = seg_name_vec
segments_df <- data.frame(
seg_id <- list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
View(segments_df)
View(segments_df)
segments_df <- data.frame(
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
segments_df <- data.frame(
cluster_code = list_st_pt$cluster_code,
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
list_st_pt <- listing_summary %>%
select(
c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"prepopulate_cluster_code",
"detail_province_name",
"detail_division",
"detail_district_name",
"detail_estimated_no_of_households",
"need_segmention",
"segment_select_segment_divide",
"segment_select_segment_1_name",
"segment_select_segment1_count",
"segment_select_segment_2_name",
"segment_select_segment2_count",
"segment_select_segment_3_name",
"segment_select_segment3_count",
"segment_select_segment_4_name",
"segment_select_segment4_count",
"segment_select_segment_5_name",
"segment_select_segment5_count",
"segment_select_segment_6_name",
"segment_select_segment6_count",
"segment_select_segment_7_name",
"segment_select_segment7_count",
"segment_select_segment_8_name",
"segment_select_segment8_count",
"segment_select_segment_9_name",
"segment_select_segment9_count",
"segment_select_segment_10_name",
"segment_select_segment10_count",
"segment_select_confirmation_segment_work",
"segment_select_confirmation_starting_point"
)
) %>%
filter(need_segmention == 1) %>%
filter(!duplicated(prepopulate_cluster_code))
names(list_st_pt) <- c(
"id",
"enumerator_name",
"enumerator_mobile",
"survey_day",
"cluster_code",
"province",
"division",
"district",
"est_hh_who",
"need_segmention",
"n_segments",
"seg1_name",
"seg1_count",
"seg2_name",
"seg2_count",
"seg3_name",
"seg3_count",
"seg4_name",
"seg4_count",
"seg5_name",
"seg5_count",
"seg6_name",
"seg6_count",
"seg7_name",
"seg7_count",
"seg8_name",
"seg8_count",
"seg9_name",
"seg9_count",
"seg10_name",
"seg10_count",
"chosen_segment",
"segment_starting_point"
)
make_segments_df <- function(list_st_pt){
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
segments_df <- data.frame(
cluster_code = list_st_pt$cluster_code,
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
return(segments_df)
}
segments_df <- make_segments_df(list_st_pt)
View(segments_df)
View(segments_df)
summary %>% left_join(segments_df)
make_segments_df <- function(list_st_pt){
seg_name_vec <- c()
seg_count_vec <- c()
for (idx in 1:nrow(list_st_pt)){
seg_id <- list_st_pt$chosen_segment[idx]
seg_name <- list_st_pt[[paste0("seg", seg_id, "_name")]][idx]
seg_count <- list_st_pt[[paste0("seg", seg_id, "_count")]][idx]
print(seg_id)
seg_name_vec <- c(seg_name_vec, seg_name)
seg_count_vec <- c(seg_count_vec, seg_count)
}
segments_df <- data.frame(
cluster_code = as.numeric(list_st_pt$cluster_code),
seg_id = list_st_pt$chosen_segment,
seg_name = seg_name_vec,
seg_count = seg_count_vec
)
return(segments_df)
}
segments_df <- make_segments_df(list_st_pt)
summary %>% left_join(segments_df)
Summary_ <- summary %>% left_join(segments_df)
Summary_seg <- summary %>% left_join(segments_df)
View(Summary_seg)
write.csv(summary_seg, "who-dash/Data/summary.csv", row.names = F, na = "")
write.csv(listing_filled,
"who-dash/Data/listing.csv",
row.names = F,
na = "")
View(list_st_pt)
View(list_st_pt)
runApp('who-dash')
write.csv(list_st_pt,
"who-dash/Data/segments.csv",
row.names = F,
na = "")
runApp('who-dash')
runApp('who-dash')
list_st_pt$chosen_segment_name <- segments_df$seg_name
View(list_st_pt)
View(list_st_pt)
seg_formatter <- formatter("span",
style = ~ style(color = ifelse(change >= 0, "green", "red")))
View(list_st_pt)
View(list_st_pt)
list_st_pt$chosen_segment_name <- segments_df$seg_name
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/who-dash/preproc0.R")
source("~/Desktop/R-Projects/WHO/preproc1.R")
source("~/Desktop/R-Projects/WHO/preproc2.R")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/who-dash/summarise.r")
summary <- listing_filled %>%
group_by(cluster_code, province_name, district, est_hh_who) %>%
summarise(
n = n(),
n_str = sum(str_stat),
max_str = max(str_index, na.rm = T),
n_hh = sum(hh_stat),
max_hh = max(hh_index, na.rm = T),
n_dwelling = sum(unit == "Dwelling"),
n_non_dwelling = sum(unit == "Non_Dwelling"),
n_subs = (length(unique(id)))
)
summary$disc_hh <- round(summary$n_hh / summary$est_hh_who, 2)
summary_seg <- summary %>% left_join(segments_df)
segments_df$cluster_code
summary$cluster_code
summary$cluster_code <- as.numeric(summary$cluster_code)
source("~/Desktop/R-Projects/WHO/read.r")
source("~/Desktop/R-Projects/WHO/who-dash/preproc0.R")
source("~/Desktop/R-Projects/WHO/preproc1.R")
source("~/Desktop/R-Projects/WHO/preproc2.R")
source("~/Desktop/R-Projects/WHO/preproc3.r")
source("~/Desktop/R-Projects/WHO/who-dash/summarise.r")
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
runApp('who-dash')
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == seg_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == segment_name, 1, 0)
segments_df <- make_segments_df(list_st_pt)
list_st_pt$chosen_segment_name <- segments_df$seg_name
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == segment_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log1 <- ifelse(list_st_pt$seg1_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log2 <- ifelse(list_st_pt$seg2_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log3 <- ifelse(list_st_pt$seg3_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log4 <- ifelse(list_st_pt$seg4_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log5 <- ifelse(list_st_pt$seg5_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log6 <- ifelse(list_st_pt$seg6_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log7 <- ifelse(list_st_pt$seg7_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log8 <- ifelse(list_st_pt$seg8_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log9 <- ifelse(list_st_pt$seg9_name == list_st_pt$chosen_segment_name, 1, 0)
list_st_pt$log10 <- ifelse(list_st_pt$seg10_name == list_st_pt$chosen_segment_name, 1, 0)
View(list_st_pt)
View(list_st_pt)
runApp('who-dash')
runApp('who-dash')
write.csv(list_st_pt,
"who-dash/Data/segments.csv",
row.names = F,
na = "")
runApp('who-dash')
runApp('who-dash')
